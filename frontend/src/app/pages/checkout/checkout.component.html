<div class="checkout-container">
  <!-- Notification de succ√®s/erreur -->
  <div class="notification-overlay" *ngIf="showNotification">
    <div class="notification-card" [ngClass]="notificationMessage">
      <div class="notification-icon">
        <svg *ngIf="notificationMessage === 'success'" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="9 12 11 14 15 10"></polyline>
        </svg>
        <svg *ngIf="notificationMessage === 'error'" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      
      <div class="notification-content">
        <h2 *ngIf="notificationMessage === 'success'">üéâ Commande confirm√©e !</h2>
        <h2 *ngIf="notificationMessage === 'error'">‚ùå Erreur</h2>
        
        <div *ngIf="notificationMessage === 'success'" class="order-details">
          <p class="order-number">Num√©ro de commande: <strong>#{{ notificationOrderId }}</strong></p>
          <p class="order-total">Total: <strong>{{ notificationTotal | number:'1.2-2' }} DT</strong></p>
          <p class="redirect-message">Redirection en cours...</p>
        </div>
        
        <p *ngIf="notificationMessage === 'error'" class="error-message">
          Une erreur s'est produite lors de la cr√©ation de votre commande.<br>
          Veuillez r√©essayer.
        </p>
      </div>
      
      <button class="close-notification" (click)="closeNotification()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <div class="checkout-header">
    <button class="btn-back" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Retour au panier
    </button>
    <h1>üìã Finaliser la commande</h1>
  </div>

  <div class="checkout-content">
    <!-- Informations de livraison -->
    <div class="delivery-section">
      <div class="section-card">
        <h2>üìç Informations de livraison</h2>
        
        <form class="delivery-form">
          <div class="form-group">
            <label for="fullName">
              Nom complet <span class="required">*</span>
            </label>
            <input
              type="text"
              id="fullName"
              [(ngModel)]="deliveryInfo.fullName"
              name="fullName"
              placeholder="Votre nom complet"
              required
            >
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">
                Email <span class="required">*</span>
              </label>
              <input
                type="email"
                id="email"
                [(ngModel)]="deliveryInfo.email"
                name="email"
                placeholder="votre@email.com"
                required
              >
            </div>

            <div class="form-group">
              <label for="phone">
                T√©l√©phone <span class="required">*</span>
              </label>
              <input
                type="tel"
                id="phone"
                [(ngModel)]="deliveryInfo.phone"
                name="phone"
                placeholder="+216 XX XXX XXX"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="address">
              Adresse <span class="required">*</span>
            </label>
            <input
              type="text"
              id="address"
              [(ngModel)]="deliveryInfo.address"
              name="address"
              placeholder="Rue, num√©ro, b√¢timent..."
              required
            >
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="city">
                Ville <span class="required">*</span>
              </label>
              <input
                type="text"
                id="city"
                [(ngModel)]="deliveryInfo.city"
                name="city"
                placeholder="Tunis, Sousse, Sfax..."
                required
              >
            </div>

            <div class="form-group">
              <label for="governorate">
                Gouvernorat <span class="required">*</span>
              </label>
              <select
                id="governorate"
                [(ngModel)]="deliveryInfo.governorate"
                name="governorate"
                required
              >
                <option value="">S√©lectionnez un gouvernorat</option>
                <option value="Ariana">Ariana</option>
                <option value="B√©ja">B√©ja</option>
                <option value="Ben Arous">Ben Arous</option>
                <option value="Bizerte">Bizerte</option>
                <option value="Gab√®s">Gab√®s</option>
                <option value="Gafsa">Gafsa</option>
                <option value="Jendouba">Jendouba</option>
                <option value="Kairouan">Kairouan</option>
                <option value="Kasserine">Kasserine</option>
                <option value="Kebili">Kebili</option>
                <option value="Kef">Kef</option>
                <option value="Mahdia">Mahdia</option>
                <option value="Manouba">Manouba</option>
                <option value="M√©denine">M√©denine</option>
                <option value="Monastir">Monastir</option>
                <option value="Nabeul">Nabeul</option>
                <option value="Sfax">Sfax</option>
                <option value="Sidi Bouzid">Sidi Bouzid</option>
                <option value="Siliana">Siliana</option>
                <option value="Sousse">Sousse</option>
                <option value="Tataouine">Tataouine</option>
                <option value="Tozeur">Tozeur</option>
                <option value="Tunis">Tunis</option>
                <option value="Zaghouan">Zaghouan</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="postalCode">Code postal</label>
              <input
                type="text"
                id="postalCode"
                [(ngModel)]="deliveryInfo.postalCode"
                name="postalCode"
                placeholder="1000"
              >
            </div>
          </div>

          <div class="form-group">
            <label for="notes">Notes additionnelles</label>
            <textarea
              id="notes"
              [(ngModel)]="deliveryInfo.additionalNotes"
              name="notes"
              rows="3"
              placeholder="Instructions de livraison, code d'acc√®s..."
            ></textarea>
          </div>
        </form>
      </div>
    </div>

    <!-- R√©sum√© de la commande -->
    <div class="summary-section">
      <div class="section-card">
        <h2>üì¶ R√©sum√© de la commande</h2>
        
        <div class="order-items">
          <div *ngFor="let item of cartItems" class="order-item">
            <span class="item-emoji">{{ getCategoryEmoji(item.type) }}</span>
            <div class="item-info">
              <h4>{{ item.name }}</h4>
              <p class="item-qty">Quantit√©: {{ item.quantity }}</p>
            </div>
            <div class="item-price">
              {{ (item.price * item.quantity) | number:'1.2-2' }} DT
            </div>
          </div>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-row">
          <span>Sous-total</span>
          <span>{{ subtotal | number:'1.2-2' }} DT</span>
        </div>

        <div class="summary-row">
          <span>Taxe (10%)</span>
          <span>{{ tax | number:'1.2-2' }} DT</span>
        </div>

        <div class="summary-row">
          <span>Frais de livraison</span>
          <span *ngIf="deliveryFee === 0" class="free-delivery">GRATUIT üéâ</span>
          <span *ngIf="deliveryFee > 0">{{ deliveryFee | number:'1.2-2' }} DT</span>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-row total">
          <span>Total √† payer</span>
          <span>{{ total | number:'1.2-2' }} DT</span>
        </div>

        <div class="delivery-note" *ngIf="subtotal < 50">
          üí° Plus que {{ (50 - subtotal) | number:'1.2-2' }} DT pour la livraison gratuite !
        </div>

        <button 
          class="btn btn-primary btn-confirm"
          (click)="confirmOrder()"
          [disabled]="!isFormValid() || isProcessing"
          [class.processing]="isProcessing"
        >
          <span *ngIf="!isProcessing">‚úÖ Confirmer la commande</span>
          <span *ngIf="isProcessing">
            <span class="spinner"></span> Traitement...
          </span>
        </button>

        <div class="payment-info">
          <p>üí≥ <strong>Paiement:</strong> Paiement √† la livraison (en esp√®ces)</p>
          <p class="small-text">
            En confirmant, vous acceptez nos conditions g√©n√©rales de vente
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
