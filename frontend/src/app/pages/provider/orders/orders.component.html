<div class="admin-layout">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Provider Panel</h2>
    </div>
    <nav class="sidebar-nav">
      <a [routerLink]="['/provider']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-text">Dashboard</span>
      </a>
      <a [routerLink]="['/provider/products']" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“¦</span>
        <span class="nav-text">Products</span>
      </a>
      <a [routerLink]="['/provider/orders']" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-text">Orders</span>
      </a>
      <a [routerLink]="['/provider/inventory']" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">Inventory</span>
      </a>
      <a [routerLink]="['/provider/reports']" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span class="nav-text">Reports</span>
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Debug panel -->
    <div style="position: fixed; top: 10px; right: 10px; background: #000; color: #0f0; padding: 10px; font-family: monospace; z-index: 9999; border-radius: 4px;">
      loading: {{ loading }}<br>
      error: {{ !!error }}<br>
      orders: {{ orders.length }}<br>
      filtered: {{ filteredOrders.length }}
    </div>

    <div class="page-header">
      <h1>ğŸ“‹ Order Management</h1>
      <p>Track and manage customer orders</p>
    </div>

    <!-- Filters and Controls -->
    <div class="controls-section">
      <div class="search-filters">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="filterOrders()"
          placeholder="Search orders, customers..." 
          class="search-input">
        
        <select 
          [(ngModel)]="selectedStatus" 
          (change)="filterOrders()" 
          class="filter-select">
          <option value="all">All Status</option>
          <option *ngFor="let status of statuses" [value]="status">{{ getStatusText(status) }}</option>
        </select>
      </div>

      <div class="order-stats">
        <div class="stat-item">
          <span class="stat-value">{{ filteredOrders.length }}</span>
          <span class="stat-label">Orders</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ totalOrderValue | number:'1.2-2' }} DT</span>
          <span class="stat-label">Total Value</span>
        </div>
      </div>
    </div>

    <!-- Orders Table -->
    <div *ngIf="loading" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading orders...</p>
    </div>

    <div *ngIf="error" class="error-state">
      <p>âŒ {{ error }}</p>
      <button (click)="loadOrders()" class="retry-btn">ğŸ”„ Retry</button>
    </div>

    <div *ngIf="!loading && !error" class="orders-table">
      <div class="table-header">
        <div>Order ID</div>
        <div>Customer</div>
        <div>Items</div>
        <div>Total</div>
        <div>Status</div>
        <div>Date</div>
        <div>Actions</div>
      </div>

      <div *ngFor="let order of filteredOrders; trackBy: trackOrder" class="table-row">
        <div class="col-id">#{{ order.id }}</div>
        <div class="col-customer">
          <div class="customer-info">
            <strong>{{ order.userName || 'N/A' }}</strong>
            <div class="customer-details">
              <div>ğŸ“§ {{ order.userEmail || 'N/A' }}</div>
              <div>ğŸ“ {{ order.userPhone || 'N/A' }}</div>
              <div>ğŸ“ {{ order.deliveryAddress || 'N/A' }}, {{ order.city || 'N/A' }}</div>
            </div>
          </div>
        </div>
        <div class="col-items">{{ getItemsText(order.items) }}</div>
        <div class="col-total">{{ order.total | number:'1.2-2' }} DT</div>
        <div class="col-status">
          <span class="status-badge" [ngClass]="getStatusClass(order.status)" 
                [style.background-color]="getStatusColor(order.status)">
            {{ getStatusText(order.status) }}
          </span>
        </div>
        <div class="col-date">{{ formatDate(order.createdAt) }}</div>
        <div class="col-actions">
          <button (click)="viewOrder(order.id)" class="action-btn view" title="View Details">
            ğŸ‘ï¸
          </button>
          <button *ngIf="canMarkAsReady(order.status)" 
                  (click)="markAsReady(order.id)" 
                  class="action-btn accept" 
                  title="Mark as Ready">
            âœ…
          </button>
          <button *ngIf="canMarkAsReady(order.status)" 
                  (click)="cancelOrder(order.id)" 
                  class="action-btn reject" 
                  title="Cancel Order">
            âŒ
          </button>
          <button (click)="printOrder(order.id)" class="action-btn print" title="Print Order">
            ğŸ–¨ï¸
          </button>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredOrders.length === 0" class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <h3>No orders found</h3>
        <p>Try adjusting your search criteria or wait for new orders to arrive</p>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div *ngIf="showOrderDetails && selectedOrder" class="modal-overlay" (click)="closeOrderDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Order Details - #{{ selectedOrder.id }}</h2>
      <button class="close-btn" (click)="closeOrderDetails()">Ã—</button>
    </div>
    
    <div class="modal-body">
      <div class="order-info-grid">
        <div class="info-section">
          <h3>Customer Information</h3>
          <div class="info-item">
            <strong>Name:</strong> {{ selectedOrder.userName || 'N/A' }}
          </div>
          <div class="info-item">
            <strong>Email:</strong> {{ selectedOrder.userEmail || 'N/A' }}
          </div>
          <div class="info-item">
            <strong>Phone:</strong> {{ selectedOrder.userPhone || 'N/A' }}
          </div>
          <div class="info-item">
            <strong>Address:</strong> {{ selectedOrder.deliveryAddress || 'N/A' }}
          </div>
          <div class="info-item">
            <strong>City:</strong> {{ selectedOrder.city || 'N/A' }}
          </div>
          <div class="info-item">
            <strong>Governorate:</strong> {{ selectedOrder.governorate || 'N/A' }}
          </div>
        </div>

        <div class="info-section">
          <h3>Order Information</h3>
          <div class="info-item">
            <strong>Order Date:</strong> {{ formatDate(selectedOrder.createdAt) }}
          </div>
          <div class="info-item">
            <strong>Status:</strong> 
            <span class="status-badge" [ngClass]="getStatusClass(selectedOrder.status)" 
                  [style.background-color]="getStatusColor(selectedOrder.status)">
              {{ getStatusText(selectedOrder.status) }}
            </span>
          </div>
          <div class="info-item" *ngIf="selectedOrder.additionalNotes">
            <strong>Notes:</strong> {{ selectedOrder.additionalNotes }}
          </div>
        </div>
      </div>

      <div class="items-section">
        <h3>Order Items</h3>
        <div class="items-table">
          <div class="items-header">
            <div>Product</div>
            <div>Quantity</div>
            <div>Price</div>
            <div>Total</div>
          </div>
          <div *ngFor="let item of selectedOrder.items" class="item-row">
            <div>{{ item.name }}</div>
            <div>{{ item.quantity }}</div>
            <div>{{ item.price | number:'1.2-2' }} DT</div>
            <div>{{ (item.total || (item.quantity * item.price)) | number:'1.2-2' }} DT</div>
          </div>
          <div class="items-total">
            <div></div>
            <div></div>
            <div><strong>Total:</strong></div>
            <div><strong>{{ selectedOrder.total | number:'1.2-2' }} DT</strong></div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button *ngIf="canMarkAsReady(selectedOrder.status)" 
              (click)="markAsReady(selectedOrder.id); closeOrderDetails()" 
              class="btn-accept">
        âœ… Mark as Ready
      </button>
      <button *ngIf="canMarkAsReady(selectedOrder.status)" 
              (click)="cancelOrder(selectedOrder.id); closeOrderDetails()" 
              class="btn-deny">
        âŒ Cancel Order
      </button>
      <button (click)="printOrder(selectedOrder.id)" class="btn-print">
        ğŸ–¨ï¸ Print
      </button>
      <button (click)="closeOrderDetails()" class="btn-close">
        Close
      </button>
    </div>
  </div>
</div>