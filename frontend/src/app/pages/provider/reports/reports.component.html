<div class="admin-layout">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Provider Panel</h2>
    </div>
    <nav class="sidebar-nav">
      <a [routerLink]="['/provider']" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-text">Dashboard</span>
      </a>
      <a [routerLink]="['/provider/products']" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“¦</span>
        <span class="nav-text">Products</span>
      </a>
      <a [routerLink]="['/provider/orders']" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-text">Orders</span>
      </a>
      <a [routerLink]="['/provider/reports']" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span class="nav-text">Reports</span>
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="page-header">
      <h1>ğŸ“ˆ Business Reports</h1>
      <p>Analytics and insights for your business</p>
    </div>

    <!-- Report Controls -->
    <div class="report-controls">
      <div class="control-group">
        <label>Report Type:</label>
        <select [(ngModel)]="selectedReport" class="control-select">
          <option *ngFor="let type of reportTypes" [value]="type.value">{{ type.label }}</option>
        </select>
      </div>

      <div class="control-group">
        <label>Time Period:</label>
        <select [(ngModel)]="selectedPeriod" class="control-select">
          <option *ngFor="let period of periods" [value]="period.value">{{ period.label }}</option>
        </select>
      </div>

      <div class="control-actions">
        <button (click)="generateReport()" class="action-btn generate">
          ğŸ”„ Generate Report
        </button>
        <button (click)="exportReport('pdf')" class="action-btn export">
          ğŸ“„ Export PDF
        </button>
        <button (click)="exportReport('excel')" class="action-btn export">
          ğŸ“Š Export Excel
        </button>
      </div>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-section">
      <h2>ğŸ“Š Key Performance Indicators</h2>
      <div class="metrics-grid" *ngIf="!loading; else loadingMetrics">
        <div class="metric-card">
          <div class="metric-icon revenue">ğŸ’°</div>
          <div class="metric-info">
            <h3>{{ metrics.totalRevenue | number:'1.2-2' }} DT</h3>
            <p>Total Revenue</p>
            <div class="metric-trend" [ngClass]="getTrendClass(metrics.growthRate)">
              <span class="trend-icon">{{ getTrendIcon(metrics.growthRate) }}</span>
              <span>{{ metrics.growthRate > 0 ? '+' : '' }}{{ metrics.growthRate | number:'1.1-1' }}%</span>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon orders">ğŸ“‹</div>
          <div class="metric-info">
            <h3>{{ metrics.totalOrders }}</h3>
            <p>Total Orders</p>
            <div class="metric-trend neutral">
              <span class="trend-icon">ğŸ“Š</span>
              <span>All time</span>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon average">ğŸ’³</div>
          <div class="metric-info">
            <h3>{{ metrics.averageOrderValue | number:'1.2-2' }} DT</h3>
            <p>Average Order Value</p>
            <div class="metric-trend neutral">
              <span class="trend-icon">ğŸ“Š</span>
              <span>Per order</span>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon satisfaction">â­</div>
          <div class="metric-info">
            <h3>{{ metrics.customerSatisfaction }}/5</h3>
            <p>Customer Satisfaction</p>
            <div class="metric-trend positive">
              <span class="trend-icon">â­</span>
              <span>Rating</span>
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #loadingMetrics>
        <div class="metrics-grid">
          <div class="metric-card" *ngFor="let i of [1,2,3,4]" style="opacity: 0.5;">
            <p style="text-align: center; padding: 20px;">Loading...</p>
          </div>
        </div>
      </ng-template>
    </div>

    <!-- Sales Performance -->
    <div class="chart-section">
      <h2>ğŸ“ˆ Sales Performance</h2>
      <div class="chart-container" *ngIf="!loading && salesData.length > 0; else noSalesData">
        <div class="chart-header">
          <h3>Weekly Sales Overview</h3>
          <div class="chart-legend">
            <div class="legend-item">
              <div class="legend-color revenue"></div>
              <span>Revenue</span>
            </div>
            <div class="legend-item">
              <div class="legend-color orders"></div>
              <span>Orders</span>
            </div>
          </div>
        </div>
        
        <div class="chart-data">
          <div *ngFor="let data of salesData" class="chart-bar">
            <div class="bar-label">{{ data.period }}</div>
            <div class="bar-container">
              <div class="bar revenue" [style.height.px]="(data.revenue / 10) || 5"></div>
              <div class="bar orders" [style.height.px]="(data.orders * 10) || 5"></div>
            </div>
            <div class="bar-values">
              <div class="value revenue">{{ data.revenue | number:'1.2-2' }} DT</div>
              <div class="value orders">{{ data.orders }} orders</div>
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #noSalesData>
        <div style="padding: 40px; text-align: center; color: #666; background: white; border-radius: 8px;">
          <i class="fas fa-chart-line" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px;"></i>
          <p style="font-size: 16px;">{{ loading ? 'Loading sales data...' : 'No sales data available for the selected period' }}</p>
        </div>
      </ng-template>
    </div>

    <!-- Top Products -->
    <div class="products-section">
      <h2>ğŸ† Top Performing Products</h2>
      <div class="products-table" *ngIf="!loading && topProducts.length > 0; else noProductsData">
        <div class="table-header">
          <div>Rank</div>
          <div>Product</div>
          <div>Category</div>
          <div>Sales</div>
          <div>Revenue</div>
          <div>Performance</div>
        </div>

        <div *ngFor="let product of topProducts; let i = index" class="table-row">
          <div class="col-rank">
            <div class="rank-badge" [class]="'rank-' + (i + 1)">{{ i + 1 }}</div>
          </div>
          <div class="col-product">{{ product.name }}</div>
          <div class="col-category">{{ product.category }}</div>
          <div class="col-sales">{{ product.sales }}</div>
          <div class="col-revenue">{{ product.revenue | number:'1.2-2' }} DT</div>
          <div class="col-performance">
            <div class="performance-bar">
              <div class="performance-fill" [style.width.%]="getPerformanceWidth(product.revenue)"></div>
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #noProductsData>
        <div style="padding: 40px; text-align: center; color: #666; background: white; border-radius: 8px;">
          <i class="fas fa-box-open" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px;"></i>
          <p style="font-size: 16px;">{{ loading ? 'Loading product data...' : 'No product sales data available' }}</p>
        </div>
      </ng-template>
    </div>

    <!-- Financial Summary -->
    <div class="financial-section" *ngIf="!loading">
      <h2>ğŸ’¼ Financial Summary</h2>
      <div class="financial-cards">
        <div class="financial-card profit">
          <div class="card-header">
            <h3>Net Profit (Est.)</h3>
            <span class="card-icon">ğŸ’°</span>
          </div>
          <div class="card-value">{{ (metrics.totalRevenue * 0.25) | number:'1.2-2' }} DT</div>
          <div class="card-change positive">Estimated at 25% margin</div>
        </div>

        <div class="financial-card expenses">
          <div class="card-header">
            <h3>Total Expenses (Est.)</h3>
            <span class="card-icon">ğŸ’¸</span>
          </div>
          <div class="card-value">{{ (metrics.totalRevenue * 0.75) | number:'1.2-2' }} DT</div>
          <div class="card-change neutral">Estimated at 75% of revenue</div>
        </div>

        <div class="financial-card margin">
          <div class="card-header">
            <h3>Profit Margin</h3>
            <span class="card-icon">ğŸ“Š</span>
          </div>
          <div class="card-value">25.0%</div>
          <div class="card-change positive">Industry standard</div>
        </div>
      </div>
    </div>
  </div>
</div>